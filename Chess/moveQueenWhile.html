<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>

<body>
<style>
  * {
    box-sizing: border-box;
    padding: 0;
    margin: 0;
  }

  table {
    border-collapse: collapse;
    background: white;
    border-spacing: 0;
  }

  td {
    width: 40px;
    height: 40px;
    border: black 1px solid;
    text-align: center;

  }

  .black_td {
    /*background: #555;*/
  }

  .blur {
    backdrop-filter: grayscale(0) contrast(10) blur(14px);
  }

  .queen {
    width: 100%;
    height: 100%;
    background: url(queen.png) center no-repeat;
    background-size: cover;
  }
</style>
<div id="board">

</div>


<script>

  "use strict";
  
  let Chessboard = {
    size: 8,
    numQueen: 8,
    numActiveQueen: 0,
    createBoard: function () {
      let divBoard = document.querySelector('#board');
      let table = document.createElement('table');
      for (let i = 1; i <= this.size; i++) {
        let tr = document.createElement('tr');
        tr.setAttribute('id', i);
        for (let j = 1; j <= this.size; j++) {
          let td = document.createElement('td');
          td.setAttribute('id', i + '-' + j);
          td.setAttribute('class', 'free');
          td.setAttribute('data-counter', '0');
          td.addEventListener('click', this.moveQueen);
          td.innerHTML = td.id;
          tr.appendChild(td);
        }
        table.appendChild(tr);
        divBoard.appendChild(table);
      }
    },
    paintingBoard: function () {
      let td = document.querySelectorAll('td');
      for (let i = 0; i < td.length; i++) {
        let numTr = Math.trunc(i / this.size);
        let numTd = i % this.size;
        if (numTr % 2) {
          if (numTd % 2) td[i].classList.add('black_td');
        } else {
          if (!(numTd % 2)) td[i].classList.add('black_td');
        }
      }
    },
    moveQueen: function () {
      let queenDiv = document.createElement('div');
      queenDiv.setAttribute('class', 'queen');
      if (this.classList.contains('queen_td')) {
        this.classList.remove("queen_td");
        this.innerHTML = '';
        Chessboard.shadowBlur(this);
        Chessboard.numActiveQueen -= 1;
      } else if (Chessboard.numActiveQueen < Chessboard.numQueen) {
        this.appendChild(queenDiv);
        this.classList.add('queen_td');
        Chessboard.showBlur(this);
        Chessboard.numActiveQueen += 1;
      }
    },
    showBlur: function (elem) {
      let cellNum = elem.id.split('-');
      let row = cellNum[0];
      let column = cellNum[1];
      let self = this;
      elem.classList.replace('free', 'blur');

      function addBlur(cell) {
        cell.classList.replace('free', 'blur');
        cell.removeEventListener('click', self.moveQueen);
        cell.dataset.counter = +cell.dataset.counter + 1;
      }

      for (let i = 1; i <= this.size; i++) {
        let cellH = document.getElementById(i + '-' + column);
        let cellW = document.getElementById(row + '-' + i);
        if (cellW.id !== elem.id) {
          addBlur(cellW);
        }
        if (cellH.id !== elem.id) {
          addBlur(cellH);
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = row - j + '-' + (column - j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          addBlur(cellD);
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = +row + j + '-' + (+column + j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          addBlur(cellD);
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = row - j + '-' + (+column + j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          addBlur(cellD)
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = +row + j + '-' + (column - j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          addBlur(cellD)
        } else {
          break
        }
      }
    },
    shadowBlur: function (elem) {
      let cellNum = elem.id.split('-');
      let row = cellNum[0];
      let column = cellNum[1];
      let self = this;
      elem.classList.replace('blur', 'free');

      function dellBlur(cell) {
        cell.addEventListener('click', self.moveQueen);
        cell.dataset.counter = cell.dataset.counter - 1;
        if (cell.dataset.counter < 1) {
          cell.classList.replace('blur', 'free');
        }
      }

      for (let i = 1; i <= this.size; i++) {
        let cellH = document.getElementById(i + '-' + column);
        let cellW = document.getElementById(row + '-' + i);
        if (cellH.id !== elem.id) {
          dellBlur(cellH);
        }
        if (cellW.id !== elem.id) {
          dellBlur(cellW);
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = row - j + '-' + (column - j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          dellBlur(cellD);
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = +row + j + '-' + (+column + j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          dellBlur(cellD);
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = +row - j + '-' + (+column + j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          dellBlur(cellD);
        } else {
          break
        }
      }
      for (let j = 1; j < this.size; j++) {
        let diagonalCell = +row + j + '-' + (column - j);
        let cellD = document.getElementById(diagonalCell);
        if (cellD && cellD.id !== elem.id) {
          dellBlur(cellD);
        } else {
          break
        }
      }
    },
    search: function () {
      let matrix = [];
      for (let i = 0; i <= Chessboard.size; i++) {
        matrix[i] = [];
        for (let j = 0; j <= Chessboard.size; j++) {
          matrix[i][j] = 1;
        }
      }
      let arr = [];
      let totalMove = [];
      let tdNode = getFreeCell();
      let a = tdNode[0];
      while(a){
        let a = tdNode[0];
        let indexNext;
        if (!tdNode.length) {
          if (!getFreeCell().length && totalMove.length === Chessboard.numQueen) {
            arr.push(totalMove);
          }
          a = totalMove[totalMove.length - 1];
          totalMove = totalMove.slice(0, -1);
          if (!a) break;
          dellUsed(a);
          tdNode = getFreeCell();
          indexNext = tdNode.indexOf(a);
          tdNode = tdNode.slice(indexNext + 1);
        } else {
          addUsed(a);
          totalMove.push(a);
          tdNode = getFreeCell();
        }
      }
      // function fnn(tdNode) {
      //   let a = tdNode[0];
      //   let indexNext;
      //   if (!tdNode.length) {
      //     if (!getFreeCell().length && totalMove.length === Chessboard.numQueen) {
      //       arr.push(totalMove);
      //     }
      //     a = totalMove[totalMove.length - 1];
      //     totalMove = totalMove.slice(0, -1);
      //     if (!a) return arr
      //     dellUsed(a);
      //     tdNode = getFreeCell();
      //     indexNext = tdNode.indexOf(a);
      //     tdNode = tdNode.slice(indexNext + 1);
      //     return fnn(tdNode)
      //   } else {
      //     addUsed(a);
      //     totalMove.push(a);
      //     tdNode = getFreeCell();
      //     return fnn(tdNode)
      //   }
      // }


      function addUsed(elem) {
        let cellNum = elem.split('-');
        let row = cellNum[0];
        let column = cellNum[1];
        matrix[row][column] += 1

        for (let i = 0; i <= Chessboard.size-1; i++) {
          if (i != row) {
            matrix[i][column] += 1;
          }
          if (i != column) {
            matrix[row][i] += 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (row - i < 0 || column - i < 0||row - i > Chessboard.size-1 || column - i > Chessboard.size-1) {
            break
          } else {
            matrix[row - i][column - i] += 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (+row + i < 0 || column - i < 0||+row + i > Chessboard.size-1 || column - i > Chessboard.size-1) {
            break
          } else {
            matrix[+row + i][column - i] += 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (row - i < 0 || +column + i < 0||row - i > Chessboard.size-1 || +column + i > Chessboard.size-1) {
            break
          } else {
            matrix[row - i][+column + i] += 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (+row + i < 0 || +column + i < 0|| +row + i  > Chessboard.size-1 || +column + i  > Chessboard.size-1) {
            break
          } else {
            matrix[+row + i][+column + i] += 1;
          }
        }
      }
      function dellUsed(elem) {
        let cellNum = elem.split('-');
        let row = cellNum[0];
        let column = cellNum[1];
        matrix[row][column] -= 1

        for (let i = 0; i <= Chessboard.size-1; i++) {
          if (i != row) {
            matrix[i][column] -= 1;
          }
          if (i != column) {
            matrix[row][i] -= 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (row - i < 0 || column - i < 0||row - i > Chessboard.size-1 || column - i > Chessboard.size-1) {
            break
          } else {
            matrix[row - i][column - i] -= 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (+row + i < 0 || column - i < 0||+row + i > Chessboard.size-1 || column - i > Chessboard.size-1) {
            break
          } else {
            matrix[+row + i][column - i] -= 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (row - i < 0 || +column + i < 0||row - i > Chessboard.size-1 || +column + i > Chessboard.size-1) {
            break
          } else {
            matrix[row - i][+column + i] -= 1;
          }
        }
        for (let i = 1; i < Chessboard.size; i++) {
          if (+row + i < 0 || +column + i < 0|| +row + i  > Chessboard.size-1 || +column + i  > Chessboard.size-1) {
            break
          } else {
            matrix[+row + i][+column + i] -= 1;
          }
        }
      }
      function getFreeCell(){
        let arr = []
        for (let i = 0; i < Chessboard.size; i++) {
          for (let j = 0; j < Chessboard.size; j++) {
            if(matrix[i][j] == 1){
              arr.push(i+'-'+j)
            }
          }
        }
        return arr
      }

      console.log(arr)
    }
  };
  Chessboard.createBoard();
  Chessboard.paintingBoard();
  Chessboard.search();


</script>


</body>
</html>
